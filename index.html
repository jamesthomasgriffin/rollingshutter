<!doctype html>
<html>
  <head>
    <link rel="manifest" href="manifest.json">
    <script type="application/ecmascript" src="js/adapter.js"></script>
    <script type="application/ecmascript" src="js/rs.js"></script>
    <style>
body {
  background-color: linen;
  margin: 0;
}

#rsCanvasdiv {
  height: 100vh;
  width: 100vw;
  max-height: 75vw;
  max-width: 133.33vh;
  margin: 0 100;
}

#rsCanvas {
  position: absolute;
  width: inherit;
  height: inherit;
  max-height: inherit;
  max-width: inherit;
  margin: 0 100;
}

#overlay {
  position: absolute;
  z-index: 10;
  width: inherit;
  height: inherit;
  max-height: inherit;
  max-width: inherit;
}
    </style>
  </head>
  <body>
    <div id="rsCanvasDiv">
      <canvas id="rsCanvas"></canvas>
      <canvas id="overlay"></canvas>
    </div>

  </body>
  <script id="shader-fs" type="x-shader/x-fragment">
varying highp vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void) {
  gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
}
  </script>
  <script id="shader-vs" type="x-shader/x-vertex">
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

varying highp vec2 vTextureCoord;

void main(void) {
  gl_Position = vec4(aVertexPosition, 0.0, 1.0);
  vTextureCoord = aTextureCoord;
}
  </script>
  <script id="shader-fs2" type="x-shader/x-fragment">
precision mediump float;

varying highp vec2 vTextureCoord;

// Only needed if using a mask to determine the delay.
//    uniform bool uUseMask;
//uniform sampler2D uMask;

// The majority of these are integers, I'm sure they're represented as floats
// for a good reason that I've forgotten.
uniform vec2 uDelayDir;
uniform float uDelayOffset;
uniform sampler2D uBank1;
uniform sampler2D uBank2;
uniform vec2 uBankSize;
uniform float uNumX;
uniform float uNumY;
uniform vec2 uVPSize;
uniform vec2 uDepositSize;
uniform float uTime;

void main(void) {
  // How many tiles per bank
  float capacity = uNumX * uNumY;
  float delay = 0.0;
  // The delay coming from the mask
  //      if (uUseMask) {
  //          delay = texture2D(uMask, vec2(vTextureCoord.s, vTextureCoord.t)).r * 2.0 * capacity;
  //      } else {
            delay = (dot(vTextureCoord, uDelayDir) + uDelayOffset) * 2.0 * capacity;
  //      }

  // The frame needed
  float bankNo = mod(uTime - ceil(delay) + 0.5, 2.0 * capacity) - 0.5;
  // Figure out which bank to use
  bool secondBank = false;
  if (bankNo >= capacity) {
    bankNo -= capacity;
    secondBank = true;
  }
  // Calculate the frame's position
  float x = mod(bankNo + 0.1, uNumX) - 0.1;
  float y = (bankNo - x) / uNumX;
  if (!secondBank) {
    gl_FragColor = texture2D(uBank1, vec2(x + vTextureCoord.s, y + vTextureCoord.t) * uDepositSize / uBankSize);
  } else {
    gl_FragColor = texture2D(uBank2, vec2(x + vTextureCoord.s, y + vTextureCoord.t) * uDepositSize / uBankSize);
  }
}
  </script>
  <script id="shader-vs2" type="x-shader/x-vertex">
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

varying highp vec2 vTextureCoord;

void main(void) {
  gl_Position = vec4(aVertexPosition, 0.0, 1.0);
  vTextureCoord = aTextureCoord;
}
  </script>
</html>
